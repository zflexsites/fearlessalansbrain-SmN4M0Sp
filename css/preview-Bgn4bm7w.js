function C(){console.log("[Preview] Initialisation du mode Ã©diteur temps rÃ©el (FOCUS SAFE MODE)"),A(),P();const f={"palette.primary":"--primary-color","palette.secondary":"--secondary-color","palette.background":"--bg-color","palette.text":"--text-color","palette.accent":"--accent-color","palette.cardBackground":"--card-bg-color","palette.textMuted":"--text-muted-color","palette.cardBorder":"--card-border-color","palette.inputBackground":"--input-bg-color","palette.chatResponseBackground":"--chat-response-bg-color",primary:"--primary-color",secondary:"--secondary-color",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardBackground:"--card-bg-color","primary-color":"--primary-color","bg-color":"--bg-color","card-bg-color":"--card-bg-color"};function d(o){if(!o)return null;if(typeof o=="string"&&o.startsWith("--"))return o;const e=String(o).trim();if(f[e])return f[e];const a=e.replace(/^palette[\._-]?/i,"").replace(/\./g,"").replace(/_/g,"").toLowerCase(),t={primary:"--primary-color",primary600:"--primary-600",primary700:"--primary-700",secondary:"--secondary-color",secondary600:"--secondary-600",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardbackground:"--card-bg-color",textmuted:"--text-muted-color",cardborder:"--card-border-color",inputbackground:"--input-bg-color",chatresponsebackground:"--chat-response-bg-color"};return t[a]?t[a]:`--${e.replace(/^palette[\._-]?/i,"").replace(/\./g,"-").replace(/_/g,"-").toLowerCase()}`}function g(o={}){if(!o||typeof o!="object")return;const e=document.documentElement;Object.keys(o).forEach(a=>{const t=o[a];if(typeof t!="string"&&typeof t!="number")return;const n=a.startsWith("--")?a:d(a)||`--${a}`;e.style.setProperty(n,String(t))}),window.requestAnimationFrame(()=>{document.body.offsetHeight})}function y(o){if(!o)return;const e=o.computed||{},a=o.palette||{},t={};Object.keys(a).forEach(n=>{const r=d(n)||d(`palette.${n}`)||`--${n}`;r&&(t[r]=a[n])}),Object.keys(e).forEach(n=>{const r=d(n)||`--${n.replace(/[A-Z]/g,c=>"-"+c.toLowerCase())}`;r&&(t[r]=e[n])}),g(t),console.log("[Preview] Applied computed palette vars:",t)}function b(o){if(o==null)return"";let e=String(o).trim();return/^[0-9A-Fa-f]{6}$/.test(e)&&(e="#"+e),e}function h(o){if(!o)return;let{property:e,value:a}=o;const t=d(e)||e,n=b(a);t&&(document.documentElement.style.setProperty(t,n),(t.includes("color")||t.includes("bg")||t.includes("background"))&&(document.body.style.transition="background-color 0.22s ease, color 0.22s ease, border-color 0.22s ease",setTimeout(()=>{document.body.style.transition=""},300)),console.log(`[Preview] Mise Ã  jour style (incoming: ${String(e)}) -> canonical: ${t}: ${n}`))}function w(o){if(!o)return;const{id:e,value:a}=o,t=document.querySelector(`[data-zflex-id="${e}"]`);if(!t){console.warn(`[Preview] Ã‰lÃ©ment introuvable : ${e}`);return}const n=t.tagName.toUpperCase();if(n==="IMG")t.src=a,t.alt||(t.alt="Image");else if(n==="I"||t.classList.contains("fa")||t.classList.contains("fas")||t.classList.contains("fab")||e.includes(".icon")){let r=String(a).trim();if(!r)return;!r.startsWith("fa-")&&!r.includes(" ")&&(r=`fa-${r}`),!r.includes("fas")&&!r.includes("fab")&&!r.includes("far")&&!r.includes("fal")&&(r=`fas ${r}`);const c=Array.from(t.classList).filter(l=>!l.startsWith("fa-")&&l!=="fas"&&l!=="fab"&&l!=="far"&&l!=="fa");t.className=`${c.join(" ")} ${r}`}else if(e.toLowerCase().includes("image")||e.includes("bg"))if(t.style.backgroundImage.includes("linear-gradient")){const r=t.style.backgroundImage.split(", url");t.style.backgroundImage=`${r[0]}, url('${a}')`}else t.style.backgroundImage=`url('${a}')`;else/<[a-z][\s\S]*>/i.test(a)?t.innerHTML=a:t.textContent=a;n!=="I"&&p(t)}function p(o){o&&(o.style.transition="transform 0.2s ease, outline 0.2s ease",o.style.outline="2px solid rgba(0, 229, 255, 0.5)",o.style.transform="scale(1.02)",o.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{o.style.transform="",o.style.outline=""},400))}function v(o){const{id:e}=o;let a=document.querySelector(`[data-zflex-section="${e.toLowerCase()}"]`)||document.querySelector(`[data-zflex-id="${e}"]`)||document.getElementById(e);a?p(a):console.log(`[Preview] Highlight: Element ${e} not found.`)}window.addEventListener("message",o=>{if(!o?.data)return;const e=o.data;if(e.source==="zflex-admin")switch(console.log("[Preview] Message reÃ§u de l'Ã©diteur:",e),e.action){case"updateElement":w(e.payload);break;case"updateStyle":h(e.payload);break;case"updatePalette":y(e.payload);break;case"updateRepeater":S(e.payload);break;case"updateVariant":x(e.payload);break;case"updateLayout":$(e.payload);break;case"highlight":v(e.payload);break;default:console.warn("[Preview] Action non reconnue:",e.action)}});function $(o){const{sections:e}=o,a=document.querySelector('main[data-page-type="home"]');a&&(console.log("[Preview] Reordering layout...",e),e.forEach(t=>{const n=a.querySelector(`[data-zflex-section="${t.type}"]`);n&&(a.appendChild(n),n.style.animation="none",n.offsetHeight,n.style.animation="fadeIn 0.5s")}))}function x(o){const{id:e,variant:a,data:t}=o,n=document.querySelector(`[data-zflex-variant-container="${e}"]`),r=document.querySelector(`template[data-zflex-variant="${e}.${a}"]`);if(!n||!r){console.warn(`[Preview] Impossible de changer le variant : ${e} -> ${a}`);return}console.log(`[Preview] Swap variant ${e} vers ${a}`);const l=r.content.cloneNode(!0).firstElementChild;l&&(m(l,t),n.style.opacity="0",setTimeout(()=>{n.innerHTML="",n.appendChild(l),n.style.opacity="1"},150))}function m(o,e){if(o.querySelectorAll("[data-zflex-bind]").forEach(t=>{const n=t.getAttribute("data-zflex-bind");if(!n)return;const r=e[n];if(r===void 0)return;const c=t;if(c.tagName==="IMG")c.src=String(r);else if(c.classList.contains("fa")||n==="icon"||c.tagName==="I"){const l=Array.from(c.classList).filter(s=>!s.startsWith("fa-")&&s!=="fas"&&s!=="fab"&&s!=="far"&&s!=="fa");let i=String(r).trim();if(!i)return;!i.startsWith("fa-")&&!i.includes(" ")&&(i=`fa-${i}`),!i.includes("fas")&&!i.includes("fab")&&!i.includes("far")&&(i=`fas ${i}`),c.className=`${l.join(" ")} ${i}`}else c.textContent=String(r)}),o.hasAttribute("data-zflex-bind")){const t=o.getAttribute("data-zflex-bind");t&&e[t]!==void 0&&(o.textContent=String(e[t]))}}function S(o){const{id:e,items:a}=o,t=document.querySelector(`[data-zflex-repeater="${e}"]`),n=document.querySelector(`template[data-zflex-template="${e}"]`);if(!t||!n){console.warn(`[Preview] Impossible de mettre Ã  jour le repeater : ${e}. Conteneur ou Template manquant.`);return}console.log(`[Preview] RÃ©gÃ©nÃ©ration du repeater ${e} avec ${a.length} Ã©lÃ©ments.`),t.innerHTML="",a.forEach((r,c)=>{const i=n.content.cloneNode(!0).firstElementChild;if(i){if(i.querySelectorAll("[data-zflex-bind]").forEach(u=>{const k=u.getAttribute("data-zflex-bind");u.setAttribute("data-zflex-id",`${e}[${c}].${k}`)}),i.hasAttribute("data-zflex-bind")){const u=i.getAttribute("data-zflex-bind");i.setAttribute("data-zflex-id",`${e}[${c}].${u}`)}m(i,r),t.appendChild(i)}}),t.style.transition="opacity 0.2s",t.style.opacity="0.5",setTimeout(()=>t.style.opacity="1",200)}function A(){console.log("[Preview] Activating Interaction Hijacking (Anti-Navigation)"),document.addEventListener("click",o=>{const e=o.target.closest("a, button, input[type='submit']");if(!e)return;if(e.classList.contains("btn-primary")||e.id.includes("add-to-cart")||e.textContent?.toLowerCase().includes("commander")||e.closest("#cart-btn")){o.preventDefault(),o.stopPropagation(),console.log("ðŸš« [Preview] Action commerciale bloquÃ©e:",e);return}if(e.tagName==="A"){const t=e.getAttribute("href");if(t&&t!=="#"&&!t.startsWith("javascript:")){o.preventDefault(),o.stopPropagation(),console.log("ðŸš« [Preview] Navigation bloquÃ©e:",t);return}}console.log("âœ… [Preview] Interaction autorisÃ©e:",e)},!0),document.addEventListener("submit",o=>{o.preventDefault(),o.stopPropagation(),console.log("ðŸš« [Preview] Soumission de formulaire bloquÃ©e.")},!0)}function P(){window.__ZFLEX_PREVIEW_MODE__=!0,console.log("ðŸš« [Preview] Analytics neutralized via Global Flag.")}window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}export{C as initPreviewMode};
