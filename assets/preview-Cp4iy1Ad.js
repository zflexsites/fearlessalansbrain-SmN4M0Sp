import{r as z}from"./app-Dt6-lju3.js";function U(){console.log("[Preview] Initialisation du mode Ã©diteur temps rÃ©el (FOCUS V2 - LIVE ARCHITECTURE)");const y=new Map;function v(t,e){y.set(t,e),console.log(`[Preview] Update buffÃ©risÃ©e pour ${t} (Ã©lÃ©ment manquant)`)}function $(){if(y.size===0)return;console.log(`[Preview] Tentative de rejouer le buffer (${y.size} messages)...`);const t=Array.from(y.values());y.clear(),t.forEach(e=>{S({data:e})})}R(),_();const x={"palette.primary":"--primary-color","palette.secondary":"--secondary-color","palette.background":"--bg-color","palette.text":"--text-color","palette.accent":"--accent-color","palette.cardBackground":"--card-bg-color","palette.textMuted":"--text-muted-color","palette.cardBorder":"--card-border-color","palette.inputBackground":"--input-bg-color","palette.chatResponseBackground":"--chat-response-bg-color",primary:"--primary-color",secondary:"--secondary-color",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardBackground:"--card-bg-color","primary-color":"--primary-color","bg-color":"--bg-color","card-bg-color":"--card-bg-color"};function g(t){if(!t)return null;if(typeof t=="string"&&t.startsWith("--"))return t;const e=String(t).trim(),o={"layout.borderRadius":"--border-radius","typography.headingFont":"--heading-font","typography.bodyFont":"--body-font","header.style":""};if(o[e])return o[e]||null;if(x[e])return x[e];const n=e.replace(/^(palette|layout|typography)[\._-]?/i,"").replace(/\./g,"").replace(/_/g,"").toLowerCase(),s={primary:"--primary-color",primary600:"--primary-600",primary700:"--primary-700",secondary:"--secondary-color",secondary600:"--secondary-600",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardbackground:"--card-bg-color",textmuted:"--text-muted-color",cardborder:"--card-border-color",inputbackground:"--input-bg-color",chatresponsebackground:"--chat-response-bg-color",borderradius:"--border-radius",headingfont:"--heading-font",bodyfont:"--body-font"};return s[n]?s[n]:`--${e.replace(/^(palette|layout|typography)[\._-]?/i,"").replace(/\./g,"-").replace(/_/g,(r,i)=>i>0?"-":"").replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`}function E(t={}){if(!t||typeof t!="object")return;const e=document.documentElement;Object.keys(t).forEach(o=>{const n=t[o];if(typeof n!="string"&&typeof n!="number")return;const s=o.startsWith("--")?o:g(o)||`--${o}`;e.style.setProperty(s,String(n))}),window.requestAnimationFrame(()=>{document.body.offsetHeight})}function C(t){const{sections:e}=t,o=document.querySelector('main[data-zflex-page-type="home"]');if(!o)return;console.log("[Preview] Syncing layout...",e);const n=Array.from(o.children).filter(r=>r.hasAttribute("data-zflex-section")),s=e.map(r=>r.type);let a=[];n.forEach(r=>{const i=r.getAttribute("data-zflex-section");i&&!s.includes(i)&&(console.log(`[Preview] Removing section ${i}`),r.remove())}),e.forEach(r=>{const i=r.type,c=i.replace(/[A-Z]/g,d=>`_${d.toLowerCase()}`),l=o.querySelector(`[data-zflex-section="${i}"]`)||o.querySelector(`[data-zflex-section="${c}"]`);l?(o.appendChild(l),l.getAttribute("data-zflex-section")!==i&&l.setAttribute("data-zflex-section",i)):(console.log(`[Preview] Missing section ${i} (checked ${c} too)`),a.push(i))}),a.length>0&&(console.warn(`[Preview] ${a.length} sections manquant(s) dans le DOM :`,a),console.info("[Preview] L'injection de template devrait suivre. Pas de reload automatique (User choice)."))}function L(t){const{type:e,html:o}=t,n=document.querySelector('main[data-zflex-page-type="home"]');if(!n){console.error("[Preview] Injection annulÃ©e : Ã‰lÃ©ment <main> introuvable.");return}console.log(`%c [Preview] Injection du partiel pour : ${e} `,"background: #4f46e5; color: white; font-weight: bold; padding: 2px 4px; border-radius: 2px;");const s=document.createElement("div");s.innerHTML=o.trim();const a=Array.from(s.childNodes);let r=null;for(const i of a){if(i.nodeType!==Node.ELEMENT_NODE)continue;const c=i,l=c.tagName.toUpperCase();if(l==="STYLE")document.head.appendChild(c);else if(l==="TEMPLATE"){const d=c.getAttribute("data-zflex-variant"),u=c.getAttribute("data-zflex-template"),f=d||u;if(f){const p=document.querySelector(`template[data-zflex-variant="${f}"], template[data-zflex-template="${f}"]`);p&&p.remove()}document.body.appendChild(c)}else if(l==="SCRIPT"){const d=document.createElement("script");Array.from(c.attributes).forEach(u=>d.setAttribute(u.name,u.value)),d.textContent=c.textContent,document.body.appendChild(d)}else console.log(`[Preview] -> Potential content node found: ${l}`),r=c}if(r)try{const i=r;i.setAttribute("data-zflex-section",e),t.data&&(console.log(`[Preview] Hydratation immÃ©diate pour ${e} avec :`,t.data),w(i,t.data,e),i.querySelectorAll("[data-zflex-repeater]").forEach(d=>{const u=d.getAttribute("data-zflex-repeater");if(!u)return;const f=u.split("."),p=f[f.length-1],m=t.data[p];Array.isArray(m)&&h(d,u,m)}));const c=n.querySelector(`[data-zflex-section="${e}"]`);c?(console.log(`[Preview] Replacing existing section: ${e}`),c.replaceWith(i)):(console.log(`[Preview] Appending new section: ${e}`),n.appendChild(i)),console.log(`[Preview] Section ${e} injectÃ©e avec succÃ¨s (+ styles/templates).`),i.style.animation="pulse-glow 1s ease-in-out",typeof z=="function"&&z(i),$()}catch(i){console.error(`[Preview] Erreur fatale lors de l'injection de ${e}:`,i),$()}}function I(t){if(!t)return;const e=t.computed||{},o=t.palette||{},n={};Object.keys(o).forEach(s=>{const a=g(s)||g(`palette.${s}`)||`--${s}`;a&&(n[a]=o[s])}),Object.keys(e).forEach(s=>{const a=g(s)||`--${s.replace(/[A-Z]/g,r=>"-"+r.toLowerCase())}`;a&&(n[a]=e[s])}),E(n),console.log("[Preview] Applied computed palette vars:",n)}function k(t){if(t==null)return"";let e=String(t).trim();return/^[0-9A-Fa-f]{6}$/.test(e)&&(e="#"+e),e}function A(t){if(!t)return;let{property:e,value:o}=t;const n=g(e)||e,s=k(o);n&&(document.documentElement.style.setProperty(n,s),(n.includes("color")||n.includes("bg")||n.includes("background"))&&(document.body.style.transition="background-color 0.22s ease, color 0.22s ease, border-color 0.22s ease",setTimeout(()=>{document.body.style.transition=""},300)),console.log(`[Preview] Mise Ã  jour style (incoming: ${String(e)}) -> canonical: ${n}: ${s}`))}function q(t,e){if(!t)return;const{id:o,value:n}=t,s=g(o);if(s&&(s.startsWith("--")||o.startsWith("palette.")||o.startsWith("layout.")||o.startsWith("typography."))&&(A({property:o,value:n}),o.includes(".")&&(o.startsWith("palette")||o.startsWith("layout")||o.startsWith("typography"))))return;const a=document.querySelectorAll(`[data-zflex-show="${o}"]`);if(a.length>0){const c=String(n)==="true";a.forEach(l=>{l.style.setProperty("display",c?"":"none","important")})}if(o==="howItWorks.showIcons")return;const r=document.querySelector(`[data-zflex-id="${o}"]`);if(!r){e?v(o,e):a.length===0&&console.warn(`[Preview] Ã‰lÃ©ment introuvable : ${o}`);return}const i=r.tagName.toUpperCase();if(i==="IMG")r.src=n,r.alt||(r.alt="Image");else if(i==="I"||r.classList.contains("fa")||r.classList.contains("fas")||r.classList.contains("fab")||r.classList.contains("far")||r.classList.contains("fal")||o.includes(".icon")){let c=String(n).trim();if(!c)return;!c.startsWith("fa-")&&!c.includes(" ")&&(c=`fa-${c}`),!c.includes("fas")&&!c.includes("fab")&&!c.includes("far")&&!c.includes("fal")&&(c=`fas ${c}`);const l=Array.from(r.classList).filter(d=>!d.startsWith("fa-")&&d!=="fas"&&d!=="fab"&&d!=="far"&&d!=="fa");if(o.includes("features.items")){const d=r.closest(".feature-visual-wrapper");if(d){const u=d.querySelector(".feature-img-bind"),f=d.querySelector(".feature-icon-bind");if(u&&f){const p=!!n&&n!==""&&n!=="null",m=u,P=m.src&&!m.src.includes("undefined")&&!m.src.endsWith("/");u.style.display=P?"":"none",f.style.display=p&&!P?"":"none"}}}r.className=`${l.join(" ")} ${c}`}else if(o.toLowerCase().includes("image")||o.includes("bg")||o.includes("cover")){const c=r.style.backgroundImage;if(c&&c.includes("gradient")){const l=c.replace(/url\(['"]?.*?['"]?\)/,`url('${n}')`);r.style.backgroundImage=l}else r.style.backgroundImage=`url('${n}')`;if(o.includes("features.items")){const l=r.closest(".feature-visual-wrapper");if(l){const d=l.querySelector(".feature-img-bind"),u=l.querySelector(".feature-icon-bind");if(d&&u){const f=!!n&&n!==""&&n!=="null";d.style.display=f?"":"none",u.style.display=f?"none":""}}}}else{const c=document.querySelectorAll(`[data-zflex-show="${o}"]`);if(c.length>0){const l=String(n)==="true";c.forEach(d=>{d.style.setProperty("display",l?"":"none","important")}),l&&b(c[0]);return}/<[a-z][\s\S]*>/i.test(String(n))?r.innerHTML=String(n):r.textContent=String(n)}i!=="I"&&b(r)}function b(t){t&&(t.style.transition="transform 0.2s ease, outline 0.2s ease",t.style.outline="2px solid rgba(0, 229, 255, 0.5)",t.style.transform="scale(1.02)",t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{t.style.transform="",t.style.outline=""},400))}function T(t){const{id:e}=t;let o=document.querySelector(`[data-zflex-section="${e.toLowerCase()}"]`)||document.querySelector(`[data-zflex-id="${e}"]`)||document.getElementById(e);o?b(o):console.log(`[Preview] Highlight: Element ${e} not found.`)}function S(t){if(!t?.data)return;const e=t.data;if(e.source==="zflex-admin")switch(console.log("[Preview] Message reÃ§u de l'Ã©diteur:",e),e.action){case"updateElement":q(e.payload,e);break;case"updateStyle":A(e.payload);break;case"updatePalette":I(e.payload);break;case"updateRepeater":W(e.payload,e);break;case"updateVariant":N(e.payload);break;case"updateLayout":C(e.payload);break;case"highlight":T(e.payload);break;case"injectTemplate":L(e.payload);break;default:console.warn("[Preview] Action non reconnue:",e.action)}}window.addEventListener("message",S);function N(t){const{id:e,variant:o,data:n}=t,s=document.querySelector(`[data-zflex-variant-container="${e}"]`),a=document.querySelector(`template[data-zflex-variant="${e}.${o}"]`);if(!s||!a){console.warn(`[Preview] Impossible de changer le variant : ${e} -> ${o} (Template/Container missing)`);return}console.log(`[Preview] Swap variant ${e} vers ${o}`);const i=a.content.cloneNode(!0).firstElementChild;i&&(w(i,n,e),i.querySelectorAll("[data-zflex-repeater]").forEach(l=>{const d=l.getAttribute("data-zflex-repeater");if(!d)return;const u=d.split("."),f=u[u.length-1],p=n[f];Array.isArray(p)&&h(l,d,p)}),s.style.opacity="0",setTimeout(()=>{s.innerHTML="",s.appendChild(i),s.style.opacity="1"},150))}function h(t,e,o){const n=document.querySelector(`template[data-zflex-template="${e}"]`);n&&(t.innerHTML="",o.forEach((s,a)=>{const i=n.content.cloneNode(!0).firstElementChild;i&&(M(i,e,a),w(i,s,`${e}[${a}]`),t.appendChild(i))}))}function M(t,e,o){if(t.querySelectorAll("[data-zflex-bind]").forEach(s=>{const a=s.getAttribute("data-zflex-bind");s.setAttribute("data-zflex-id",`${e}[${o}].${a}`)}),t.hasAttribute("data-zflex-bind")){const s=t.getAttribute("data-zflex-bind");t.setAttribute("data-zflex-id",`${e}[${o}].${s}`)}}function w(t,e,o=""){const n=t.querySelectorAll("[data-zflex-bind]"),s=(a,r,i)=>{if(i==null)return;const c=a.tagName.toUpperCase();if(c==="IMG")a.src=String(i);else if(r==="icon"||a.tagName==="I"||a.classList.contains("fa")){let l=String(i).trim();if(l){!l.startsWith("fa-")&&!l.includes(" ")&&(l=`fa-${l}`),!l.includes("fas")&&!l.includes("fab")&&(l=`fas ${l}`);const d=Array.from(a.classList).filter(u=>!u.startsWith("fa")&&u!=="fas"&&u!=="fab");a.className=`${d.join(" ")} ${l}`}}else if(r.includes("image")||r.includes("bg")||r.includes("cover")){if(c!=="IMG"){const l=a.style.backgroundImage||window.getComputedStyle(a).backgroundImage;if(l&&l.includes("gradient")){const d=l.replace(/url\(['"]?.*?['"]?\)/,`url('${i}')`);a.style.backgroundImage=d}else a.style.backgroundImage=`url('${i}')`}}else r==="image_position"?i==="left"?(a.classList.remove("image-right"),a.classList.add("image-left")):(a.classList.remove("image-left"),a.classList.add("image-right")):r==="style"&&a.classList.contains("reveal-section")?a.className=a.className.replace(/style-\w+/,`style-${i}`):a.textContent=String(i)};if(n.forEach(a=>{const r=a.getAttribute("data-zflex-bind");r&&(console.log(`[Preview] -> Hydrating ${o}.${r} =`,e[r]),s(a,r,e[r]))}),t.hasAttribute("data-zflex-bind")){const a=t.getAttribute("data-zflex-bind");a&&s(t,a,e[a])}if(o.includes("reveal")&&e.image_position){const a=t.querySelector(".reveal-grid");a&&s(a,"image_position",e.image_position)}}function W(t,e){const{id:o,items:n}=t,s=document.querySelector(`[data-zflex-repeater="${o}"]`);s?(console.log(`[Preview] RÃ©gÃ©nÃ©ration du repeater ${o}`),h(s,o,n),s.style.transition="opacity 0.2s",s.style.opacity="0.5",setTimeout(()=>s.style.opacity="1",200)):e?v(o,e):console.warn(`[Preview] Repeater container not found: ${o}`)}function R(){console.log("[Preview] Activating Interaction Hijacking (Anti-Navigation)"),document.addEventListener("click",t=>{const e=t.target.closest("a, button, input[type='submit']");if(!e)return;if(e.classList.contains("btn-primary")||e.id.includes("add-to-cart")||e.textContent?.toLowerCase().includes("commander")||e.closest("#cart-btn")){t.preventDefault(),t.stopPropagation(),console.log("ðŸš« [Preview] Action commerciale bloquÃ©e:",e);return}if(e.tagName==="A"){const n=e.getAttribute("href");if(n&&n!=="#"&&!n.startsWith("javascript:")){t.preventDefault(),t.stopPropagation(),console.log("ðŸš« [Preview] Navigation bloquÃ©e:",n);return}}console.log("âœ… [Preview] Interaction autorisÃ©e:",e)},!0),document.addEventListener("submit",t=>{t.preventDefault(),t.stopPropagation(),console.log("ðŸš« [Preview] Soumission de formulaire bloquÃ©e.")},!0)}function _(){window.__ZFLEX_PREVIEW_MODE__=!0,console.log("ðŸš« [Preview] Analytics neutralized via Global Flag.")}window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}export{U as initPreviewMode};
